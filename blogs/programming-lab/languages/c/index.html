<!doctype html>
<html lang="en">
    <head>
        <meta charset="UTF-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1.0" />
        <title>C Programming IDE - Ariq Azmain Lab</title>

        <!-- Fonts & Icons -->
        <link
            rel="stylesheet"
            href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css"
        />
        <link
            href="https://fonts.googleapis.com/css2?family=JetBrains+Mono:wght@300;400;500;700&family=Poppins:wght@300;400;500;600;700&family=Inter:wght@300;400;500;600;700&display=swap"
            rel="stylesheet"
        />

        <!-- CodeMirror -->
        <link
            rel="stylesheet"
            href="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.5/codemirror.min.css"
        />
        <link
            rel="stylesheet"
            href="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.5/theme/dracula.min.css"
        />
        <link
            rel="stylesheet"
            href="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.5/addon/display/fullscreen.min.css"
        />
        <link
            rel="stylesheet"
            href="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.5/addon/fold/foldgutter.min.css"
        />

        <!-- CSS Files -->
        <link rel="stylesheet" href="../../../styles/main.css" />
        <link rel="stylesheet" href="../../styles/animations.css" />
        <link rel="stylesheet" href="style.css" />
    </head>
    <body>
        <!-- Animated Background -->
        <div class="animated-bg">
            <div class="code-particles"></div>
        </div>

        <!-- IDE Container -->
        <div class="ide-container">
            <!-- Top Bar -->
            <div class="ide-topbar">
                <div class="topbar-left">
                    <a href="../../index.html" class="back-btn">
                        <i class="fas fa-arrow-left"></i> Back to Lab
                    </a>
                    <div class="language-info">
                        <div class="lang-icon c">
                            <i class="fab fa-c"></i>
                        </div>
                        <div>
                            <h2>C Programming IDE</h2>
                            <p>Write, compile and debug C programs</p>
                        </div>
                    </div>
                </div>

                <div class="topbar-right">
                    <div class="file-menu">
                        <button class="btn btn-menu" id="fileMenuBtn">
                            <i class="fas fa-file"></i> File
                        </button>
                        <div class="dropdown-menu" id="fileDropdown">
                            <a href="#" id="newFileBtn"
                                ><i class="fas fa-file"></i> New File</a
                            >
                            <a href="#" id="openFileBtn"
                                ><i class="fas fa-folder-open"></i> Open File</a
                            >
                            <a href="#" id="saveFileBtn"
                                ><i class="fas fa-save"></i> Save File</a
                            >
                            <a href="#" id="saveAsBtn"
                                ><i class="fas fa-save"></i> Save As...</a
                            >
                            <hr />
                            <a href="#" id="exportCodeBtn"
                                ><i class="fas fa-download"></i> Export Code</a
                            >
                        </div>
                    </div>

                    <button class="btn btn-run" id="runBtn">
                        <i class="fas fa-play"></i> Run (Ctrl+Enter)
                    </button>
                    <button class="btn btn-debug" id="debugBtn">
                        <i class="fas fa-bug"></i> Debug
                    </button>
                    <button class="btn btn-layout" id="layoutBtn">
                        <i class="fas fa-exchange-alt"></i> Layout
                    </button>
                </div>
            </div>

            <!-- Main IDE Area -->
            <div class="ide-main" id="ideMain">
                <!-- Left Panel: Editor -->
                <div class="ide-panel editor-panel" id="editorPanel">
                    <div class="panel-header">
                        <div class="panel-tabs">
                            <button class="tab active" data-tab="main.c">
                                main.c
                            </button>
                            <div class="tab-actions">
                                <button
                                    class="tab-action-btn"
                                    id="addTabBtn"
                                    title="New Tab"
                                >
                                    <i class="fas fa-plus"></i>
                                </button>
                                <button
                                    class="tab-action-btn"
                                    id="closeTabBtn"
                                    title="Close Tab"
                                >
                                    <i class="fas fa-times"></i>
                                </button>
                            </div>
                        </div>
                        <div class="panel-actions">
                            <button
                                class="action-btn"
                                id="formatBtn"
                                title="Format Code"
                            >
                                <i class="fas fa-indent"></i>
                            </button>
                            <button
                                class="action-btn"
                                id="themeToggle"
                                title="Toggle Theme"
                            >
                                <i class="fas fa-moon"></i>
                            </button>
                            <button
                                class="action-btn"
                                id="fullscreenBtn"
                                title="Fullscreen"
                            >
                                <i class="fas fa-expand"></i>
                            </button>
                        </div>
                    </div>
                    <div class="code-editor-container">
                        <textarea
                            id="codeEditor"
                            class="code-editor"
                        ></textarea>
                    </div>
                    <div class="panel-footer">
                        <div class="editor-info">
                            <span class="cursor-position">Ln 1, Col 1</span>
                            <span class="file-size">0 bytes</span>
                            <span class="language-tag">C</span>
                        </div>
                        <div class="editor-status">
                            <i class="fas fa-circle status-ready"></i>
                            <span>Ready</span>
                        </div>
                    </div>
                </div>

                <!-- Resizer -->
                <div
                    class="panel-resizer vertical-resizer"
                    id="verticalResizer"
                ></div>

                <!-- Right Panel: Output/Console -->
                <div class="ide-panel console-panel" id="consolePanel">
                    <div class="panel-header">
                        <div class="panel-tabs">
                            <button class="tab active" data-tab="output">
                                Output
                            </button>
                            <button class="tab" data-tab="debug">Debug</button>
                            <button class="tab" data-tab="terminal">
                                Terminal
                            </button>
                            <button class="tab" data-tab="problems">
                                Problems
                            </button>
                        </div>
                        <div class="panel-actions">
                            <button
                                class="action-btn"
                                id="clearConsoleBtn"
                                title="Clear Console"
                            >
                                <i class="fas fa-trash"></i>
                            </button>
                            <button
                                class="action-btn"
                                id="copyOutputBtn"
                                title="Copy Output"
                            >
                                <i class="fas fa-copy"></i>
                            </button>
                            <button
                                class="action-btn"
                                id="downloadOutputBtn"
                                title="Download Output"
                            >
                                <i class="fas fa-download"></i>
                            </button>
                        </div>
                    </div>
                    <div class="console-output" id="consoleOutput">
                        <div class="welcome-message">
                            <h3><i class="fas fa-code"></i> C IDE Ready</h3>
                            <p>
                                Write your C code in the editor and press Run to
                                compile and execute.
                            </p>

                            <div class="quick-start">
                                <h4>Quick Start:</h4>
                                <div class="code-snippet">
                                    <pre>
#include &lt;stdio.h&gt;

int main() {
    printf("Hello, World!\\n");
    return 0;
}</pre
                                    >
                                </div>
                            </div>

                            <div class="example-buttons">
                                <p>Try these examples:</p>
                                <div class="example-grid">
                                    <button
                                        class="example-btn"
                                        data-example="hello"
                                    >
                                        <i class="fas fa-play-circle"></i> Hello
                                        World
                                    </button>
                                    <button
                                        class="example-btn"
                                        data-example="variables"
                                    >
                                        <i class="fas fa-calculator"></i>
                                        Variables
                                    </button>
                                    <button
                                        class="example-btn"
                                        data-example="conditions"
                                    >
                                        <i class="fas fa-code-branch"></i>
                                        If-Else
                                    </button>
                                    <button
                                        class="example-btn"
                                        data-example="loops"
                                    >
                                        <i class="fas fa-redo"></i> Loops
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="panel-footer">
                        <div class="console-input">
                            <div class="input-prefix">
                                <i class="fas fa-terminal"></i>
                                <span>$</span>
                            </div>
                            <input
                                type="text"
                                id="consoleInput"
                                placeholder="Type commands here..."
                            />
                            <button id="sendInputBtn" class="input-send">
                                <i class="fas fa-arrow-right"></i>
                            </button>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Bottom Panel: Examples and Tools -->
            <div class="ide-bottom" id="ideBottom">
                <div class="panel-header">
                    <div class="panel-tabs">
                        <button class="tab active" data-tab="examples">
                            Examples
                        </button>
                        <button class="tab" data-tab="snippets">
                            Snippets
                        </button>
                        <button class="tab" data-tab="explorer">
                            Explorer
                        </button>
                        <button class="tab" data-tab="settings">
                            Settings
                        </button>
                    </div>
                    <div class="panel-search">
                        <input
                            type="text"
                            placeholder="Search examples..."
                            id="exampleSearch"
                        />
                        <i class="fas fa-search"></i>
                    </div>
                    <button
                        class="action-btn"
                        id="toggleExamplesBtn"
                        title="Toggle Examples"
                    >
                        <i class="fas fa-chevron-down"></i>
                    </button>
                </div>
                <div class="examples-container" id="examplesContainer">
                    <!-- Examples loaded dynamically -->
                </div>
            </div>

            <!-- Resizer for Bottom Panel -->
            <div
                class="panel-resizer horizontal-resizer"
                id="horizontalResizer"
            ></div>
        </div>

        <!-- JavaScript Files -->
        <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.5/codemirror.min.js"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.5/mode/clike/clike.min.js"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.5/addon/edit/closebrackets.min.js"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.5/addon/edit/matchbrackets.min.js"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.5/addon/display/fullscreen.min.js"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.5/addon/fold/foldcode.min.js"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.5/addon/fold/foldgutter.min.js"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.5/addon/fold/brace-fold.min.js"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.5/addon/comment/comment.min.js"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.5/addon/selection/active-line.min.js"></script>

        <!-- Our Scripts -->
        <script>
            // Improved C Compiler with better output handling
            class CCompiler {
                constructor() {
                    this.name = "C Compiler";
                    this.version = "1.0.0";
                    this.isReady = true;
                }

                async execute(code, input = "") {
                    return new Promise(resolve => {
                        setTimeout(() => {
                            // Real execution simulation
                            let output = "";
                            let error = null;
                            let success = true;

                            try {
                                // Parse the code to generate appropriate output
                                if (code.includes("printf")) {
                                    // Extract text from printf statements
                                    const printfMatches = code.match(
                                        /printf\s*\(\s*"([^"]+)"[^)]*\)/g
                                    );
                                    if (printfMatches) {
                                        printfMatches.forEach(match => {
                                            const textMatch =
                                                match.match(/"([^"]+)"/);
                                            if (textMatch) {
                                                output +=
                                                    textMatch[1]
                                                        .replace(/\\n/g, "\n")
                                                        .replace(/\\t/g, "\t") +
                                                    "\n";
                                            }
                                        });
                                    }
                                }

                                if (code.includes("scanf")) {
                                    if (input) {
                                        output += `Input received: ${input}\n`;
                                    } else {
                                        output += "Waiting for input...\n";
                                    }
                                }

                                // Check for common C patterns
                                if (
                                    code.includes("for") ||
                                    code.includes("while")
                                ) {
                                    output += "Loop executed successfully\n";
                                }

                                if (
                                    code.includes("if") ||
                                    code.includes("else")
                                ) {
                                    output += "Conditional logic executed\n";
                                }

                                if (output.trim() === "") {
                                    output =
                                        "Program executed successfully (no output)\n";
                                }
                            } catch (err) {
                                success = false;
                                error = err.message;
                                output = `Error: ${err.message}\n`;
                            }

                            const executionTime = Math.random() * 50 + 20; // 20-70ms

                            resolve({
                                success: success,
                                output: output,
                                error: error,
                                language: "c",
                                timestamp: Date.now(),
                                executionTime: `${executionTime.toFixed(0)}ms`,
                                simulated: true
                            });
                        }, 300); // Reduced delay for better UX
                    });
                }

                formatCode(code) {
                    let formatted = code
                        .replace(/\s*{\s*/g, " {\n")
                        .replace(/\s*}\s*/g, "\n}\n")
                        .replace(/;\s*/g, ";\n")
                        .replace(/\n\s*\n/g, "\n")
                        .replace(/^\s+/gm, "");

                    let indentLevel = 0;
                    const lines = formatted.split("\n");
                    formatted = lines
                        .map(line => {
                            line = line.trim();
                            if (line.startsWith("}") || line === "};") {
                                indentLevel = Math.max(0, indentLevel - 1);
                            }

                            const indentedLine =
                                "    ".repeat(indentLevel) + line;

                            if (line.endsWith("{") || line === "{") {
                                indentLevel++;
                            }

                            return indentedLine;
                        })
                        .join("\n");

                    return formatted;
                }
            }

            // Initialize C Compiler
            window.cCompiler = new CCompiler();

            // Global compiler API wrapper
            window.compilerAPI = {
                async execute(language, code, input = "", options = {}) {
                    if (language === "c") {
                        return await window.cCompiler.execute(code, input);
                    }

                    return {
                        success: true,
                        output: `Simulated execution for ${language}\nCode executed successfully.`,
                        error: null,
                        language,
                        timestamp: Date.now(),
                        executionTime: "50ms",
                        simulated: true
                    };
                }
            };
        </script>

        <script src="script.js"></script>
    </body>
</html>
